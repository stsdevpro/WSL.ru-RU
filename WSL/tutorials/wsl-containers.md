---
title: Приступая к работе с контейнерами DOCKER с подсистемой Windows для Linux
description: Узнайте, как настроить контейнеры DOCKER в подсистеме Windows для Linux.
keywords: WSL, Windows, виндовссубсистем, Windows 10, Docker, контейнеры
ms.date: 08/28/2020
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: a972cd6f179059e0841e1aef4bc3929fa46fcc4d
ms.sourcegitcommit: 1c7f2e9928672ad3941a9327162595cb73ef5a3f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "89609726"
---
# <a name="get-started-with-docker-remote-containers-on-wsl-2"></a>Начало работы с удаленными контейнерами DOCKER в WSL 2

Это пошаговое руководство поможет приступить к разработке с помощью удаленных контейнеров, **настроив для Windows классическую версию DOCKER, WSL 2** (подсистему Windows для Linux, версия 2).

Служба DOCKER Desktop для Windows доступна бесплатно и предоставляет среду разработки для создания, доставки и запуска приложений пакетных. Включив модуль на основе WSL 2, вы можете запускать контейнеры Linux и Windows на рабочем столе DOCKER на одном компьютере.

## <a name="overview-of-docker-containers"></a>Общие сведения о контейнерах DOCKER

DOCKER — это средство, используемое для создания, развертывания и запуска приложений с помощью контейнеров. Контейнеры позволяют разработчикам упаковывать приложения с использованием всех необходимых компонентов (библиотек, платформ, зависимостей и т. д.) и поставлять все это как один пакет. Использование контейнера гарантирует, что приложение будет работать одинаково независимо от настроенных параметров или ранее установленных библиотек на компьютере, где он работает, который может отличаться от компьютера, который использовался для написания и тестирования кода приложения. Это позволяет разработчикам сосредоточиться на написании кода, не беспокоясь о том, на какой системе будет выполняться код.

Контейнеры DOCKER похожи на виртуальные машины, но не создают всю виртуальную операционную систему. Вместо этого DOCKER позволяет приложению использовать тот же ядро Linux, что и система, на которой он работает. Это позволяет пакету приложения требовать только те части, которые еще не находятся на главном компьютере, уменьшая размер пакета и повышая производительность.

Постоянная доступность, использование контейнеров DOCKER с такими инструментами, как [Kubernetes](https://docs.microsoft.com/azure/aks/), является еще одной причиной популярности контейнеров. Это позволяет создавать несколько версий контейнера приложения в разное время. Вместо того чтобы занимать всю систему для обновления или обслуживания, каждый контейнер (и его конкретные микрослужбы) можно заменить на лету. Вы можете подготовить новый контейнер со всеми обновлениями, настроить контейнер для рабочей среды и просто указать новый контейнер после его готовности. Вы также можете архивировать различные версии приложения, используя контейнеры, и при необходимости обеспечить их запуск в качестве резервной стратегии обеспечения безопасности.

Дополнительные сведения см. в разделе [Введение в контейнеры DOCKER](https://docs.microsoft.com/learn/modules/intro-to-docker-containers/) на Microsoft Learn.

## <a name="prerequisites"></a>Предварительные требования

- Убедитесь, что на компьютере установлена ОС Windows 10, [обновлена до версии 2004](ms-settings:windowsupdate), **Сборка 18362** или более поздняя версия.
- [Включите WSL, установите дистрибутив Linux и обновите его до версии WSL 2](https://docs.microsoft.com/windows/wsl/install-win10).
- [Скачайте и установите пакет обновления ядра Linux](https://docs.microsoft.com/windows/wsl/wsl2-kernel).
- [Установите Visual Studio Code](https://code.visualstudio.com/download) *(необязательно)*. Это обеспечит лучшие возможности, включая возможность кодирования и отладки в удаленном контейнере DOCKER и подключения к дистрибутиву Linux.
- [Установите терминал Windows](https://docs.microsoft.com/windows/terminal/get-started) *(необязательно)*. Это обеспечит лучшие возможности, включая возможность настройки и открытия нескольких терминалов в одном интерфейсе (включая Ubuntu, Debian, PowerShell, Azure CLI или то, что вы предпочитаете использовать).
- [Зарегистрируйте идентификатор DOCKER в DOCKER Hub](https://hub.docker.com/signup) *(необязательно)*.

> [!NOTE]
> WSL может запускать дистрибутивы в режиме WSL версии 1 или WSL 2. Это можно проверить, открыв PowerShell и введя: `wsl -l -v` . Убедитесь, что дистрибутив настроен на использование WSL 2, введя: `wsl --set-version  <distro> 2` . Замените на `<distro>` имя дистрибутив (например, Ubuntu 18,04).
> 
> В WSL версии 1 из-за фундаментальных различий между Windows и Linux подсистема DOCKER не смогла запуститься непосредственно внутри WSL, поэтому Группа DOCKER разработала альтернативное решение с использованием виртуальных машин Hyper-V и Линукскит. Однако поскольку WSL 2 теперь работает в ядре Linux с полной емкостью системных вызовов, Docker можно полностью запустить в WSL 2. Это означает, что контейнеры Linux могут работать изначально без эмуляции, что обеспечивает лучшую производительность и совместимость со средствами Windows и Linux.

## <a name="install-docker-desktop"></a>Установка Docker Desktop

Если серверная часть WSL 2 поддерживается в DOCKER Desktop для Windows, вы можете работать в среде разработки на основе Linux и создавать контейнеры на основе Linux, используя Visual Studio Code для редактирования кода и отладки, а также запуска контейнера в браузере Microsoft ребра в Windows.

Чтобы установить DOCKER (после [установки WSL 2](https://docs.microsoft.com/windows/wsl/install-win10)), сделайте следующее:

1. Скачайте [DOCKER Desktop](https://docs.docker.com/docker-for-windows/wsl/#download) и следуйте инструкциям по установке.

2. После установки запустите приложение DOCKER Desktop из меню "Пуск" Windows, а затем выберите значок DOCKER в меню "скрытые значки" панели задач. Щелкните правой кнопкой мыши значок, чтобы открыть меню команд DOCKER и выбрать пункт "Параметры".
    ![Значок панели мониторинга для DOCKER Desktop](../media/docker-starting.png)

3. Убедитесь, что флажок "использовать ядро на основе WSL 2" установлен в **параметрах**  >  **Общие**.
    ![Общие параметры DOCKER Desktop](../media/docker-running.png)

4. Выберите из установленных дистрибутивов WSL 2, для которых вы хотите включить интеграцию с DOCKER, перейдя по следующим **параметрам**  >  **ресурсы**  >  **WSL Integration**.
    ![Параметры ресурсов DOCKER Desktop](../media/docker-dashboard.png)

5. Чтобы убедиться, что DOCKER установлен, откройте дистрибутив WSL (например, Ubuntu) и отобразите версию и номер сборки, введя следующее: `docker --version`

6. Проверьте, правильно ли работает установка, выполнив простой встроенный образ DOCKER с помощью: `docker run hello-world`

> [!TIP]
> Вот несколько полезных команд DOCKER для получения сведений:
>
> - Перечислите команды, доступные в интерфейсе командной строки DOCKER, введя: `docker`
> - Вывод сведений о конкретной команде с помощью: `docker <COMMAND> --help`
> - Перечислите образы DOCKER на вашем компьютере (это только образ Hello-World), используя следующие команды: `docker image ls --all`
> - Перечислите контейнеры на компьютере с помощью: `docker container ls --all` или `docker ps -a` (без флага Показать все, будут отображаться только выполняющиеся контейнеры).
> - Перечислите системную информацию об установке DOCKER, включая статистику и ресурсы (память ЦП &), доступные в контексте WSL 2, с помощью: `docker info`

## <a name="develop-in-remote-containers-using-vs-code"></a>Разработка в удаленных контейнерах с помощью VS Code

Чтобы приступить к разработке приложений с помощью DOCKER с WSL 2, мы рекомендуем использовать VS Code, а также расширение Remote-WSL и расширение DOCKER.

- [Установите VS Code расширение Remote-WSL](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl). Это расширение позволяет открыть проект Linux, работающий на WSL, в VS Code (не нужно беспокоиться о проблемах с путями, двоичной совместимости или других задачах, связанных с разными операционными системами).

- [Установите расширение удаленных контейнеров VS Code](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers). Это расширение позволяет открыть папку проекта или репозиторий в контейнере, используя преимущества полного набора функций Visual Studio Code для выполнения разработки в контейнере.

- [Установите VS Code расширение DOCKER](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker). Это расширение добавляет функциональные возможности для создания и развертывания контейнерных приложений, а также управления ими в VS Code. (Для фактического использования контейнера в качестве среды разработки необходимо расширение удаленного контейнера.)

Давайте создадим контейнер разработки для существующего проекта приложения с помощью DOCKER.

1. В этом примере я использую исходный код из [руководства по Hello World Django](https://docs.microsoft.com/windows/python/web-frameworks#hello-world-tutorial-for-django) в среде разработки Python Настройка документов. Этот шаг можно пропустить, если вы предпочитаете использовать собственный исходный код проекта. Чтобы загрузить веб-приложение HelloWorld-Django из GitHub, откройте терминал WSL (например, Ubuntu) и введите: `git clone https://github.com/mattwojo/helloworld-django.git`

    > [!NOTE]
    > Всегда храните код в той же файловой системе, в которой вы используете средства. Это приведет к повышению производительности доступа к файлам. В этом примере мы используем Linux дистрибутив (Ubuntu) и хотим сохранить файлы проекта в файловой системе WSL `\\wsl\` . Хранение файлов проекта в файловой системе Windows значительно замедляет работу при использовании средств Linux в WSL для доступа к этим файлам.

2. В терминале WSL измените каталоги на папку исходного кода для этого проекта:

    ```bash
    cd helloworld-django
    ```

3. Откройте проект в VS Code, работающем на локальном сервере расширений Remote-WSL, введя следующее:

    ```bash
    code .
    ```

    Убедитесь, что вы подключены к WSL Linux дистрибутив, проверив зеленый индикатор зеленого цвета в левом нижнем углу экземпляра VS Code.

    ![Удаленный индикатор VS Code WSL](../media/vscode-remote-indicator.png)

4. В VS Code команде паллетте (Ctrl + Shift + P) введите: **Remote-Containers: Open Folder in контейнер...** Если эта команда не отображается при вводе, убедитесь, что вы установили расширение удаленного контейнера, связанное выше.

    ![VS Code удаленной команды контейнера](../media/docker-extension.png)

5. Выберите папку проекта, которую вы хотите контейнеризовать. В моем случае это `\\wsl\Ubuntu-20.04\home\mattwojo\repos\helloworld-django\`

    ![VS Code папку удаленного контейнера](../media/docker-extension2.png)

6. Появится список определений контейнеров, так как в папке проекта (репозитории) еще нет конфигурации Девконтаинер. Список отображаемых определений конфигурации контейнера фильтруется на основе типа проекта. Для моего проекта Django я выберу Python 3.

    ![VS Code определений конфигурации удаленных контейнеров](../media/docker-extension3.png)

7. Откроется новый экземпляр VS Code, начнется создание нового образа и после завершения сборки будет запущен наш контейнер. Вы увидите, что новая `.devcontainer` Папка содержит сведения о конфигурации контейнера в `Dockerfile` `devcontainer.json` файле и.  

    ![Папка VS Code. девконтаинер](../media/docker-extension4.png)

8. Чтобы убедиться, что проект по-прежнему подключен к WSL и в контейнере, откройте VS Code интегрированный терминал (Ctrl + Shift + ~). Проверьте операционную систему, введя: `uname` и версию Python с: `python3 --version` . Вы видите, что uname возвращено как Linux, поэтому вы все еще подключены к подсистеме WSL 2, а номер версии Python будет основан на конфигурации контейнера, которая может отличаться от версии Python, установленной в дистрибутиве WSL.

9. Чтобы запустить и выполнить отладку приложения в контейнере с помощью Visual Studio Code, сначала откройте меню **выполнить** (Ctrl + Shift + D или выберите вкладку в левой строке меню). Затем выберите **Запуск и отладка** , чтобы выбрать конфигурацию отладки и выбрать конфигурацию, наиболее подходящую для вашего проекта (в нашем примере это будет «Django»). При этом `launch.json` в папке проекта будет создан файл `.vscode` с инструкциями по запуску приложения.

    ![VS Code запустить конфигурацию отладки](../media/vscode-run-config.png)

10. В VS Code выберите **запустить**  >  **отладку запуска** (или просто нажмите клавишу **F5** ). При этом откроется окно терминала в VS Code. результат должен выглядеть следующим образом: "Запуск сервера разработки при http://127.0.0.1:8000/ выходе из системы на сервере с помощью Control-C". Удерживайте клавишу CTRL и выберите отображаемый адрес, чтобы открыть приложение в веб-браузере по умолчанию и увидеть, что проект работает в контейнере.

    ![VS Code Запуск контейнера DOCKER](../media/vscode-running-in-container.png)

Вы успешно настроили удаленный контейнер разработки с помощью DOCKER Desktop, на базе серверной части WSL 2, который можно использовать для кодирования, сборки, запуска, развертывания или отладки с помощью VS Code!

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="wsl-docker-context-deprecated"></a>Нерекомендуемый контекст DOCKER WSL

Если вы использовали предварительную ознакомительную версию DOCKER для WSL, возможно, у вас есть контекст DOCKER с именем "WSL", который теперь устарел и больше не используется. Можно проверить с помощью команды: `docker context ls` . Вы можете удалить контекст "WSL", чтобы избежать ошибок с помощью команды: `docker context rm wsl` так, как вы хотите использовать контекст по умолчанию для Windows и WSL2.

Возможные ошибки, которые могут возникнуть при работе с этим нерекомендуемым контекстом WSL, включают: `docker wsl open //./pipe/docker_wsl: The system cannot find the file specified.` или `error during connect: Get http://%2F%2F.%2Fpipe%2Fdocker_wsl/v1.40/images/json?all=1: open //./pipe/docker_wsl: The system cannot find the file specified.`

Дополнительные сведения об этой ошибке см. в статье [Настройка DOCKER в Windows System для Linux (WSL2) в Windows 10](https://www.hanselman.com/blog/HowToSetUpDockerWithinWindowsSystemForLinuxWSL2OnWindows10.aspx).

### <a name="trouble-finding-docker-image-storage-folder"></a>Не удается найти папку хранилища образов DOCKER

DOCKER создает две папки дистрибутив для хранения данных:
- \\WSL $ \доккер-десктоп
- \\WSL $ \доккер-десктоп-Дата

Эти папки можно найти, открыв дистрибутив WSL Linux и введя: `explorer.exe .` для просмотра папки в проводнике Windows. Введите: `\\wsl\<distro name>\mnt\wsl` замените `<distro name>` именем вашего распространения (IE. Ubuntu-20,04) для просмотра этих папок.

Дополнительные сведения о поиске расположений хранилищ DOCKER в WSL см. в этой [статье из РЕПОЗИТОРИЯ WSL](https://github.com/microsoft/WSL/issues/4176) или этой [стакковерлов записи](https://stackoverflow.com/questions/62380124/where-docker-image-is-stored-with-docker-desktop-for-windows).

Дополнительные сведения об устранении общих проблем в WSL см. в документации по [устранению неполадок](../troubleshooting.md) .

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Документы docker: рекомендации по использованию приложения DOCKER Desktop с WSL 2](https://docs.docker.com/docker-for-windows/wsl/#best-practices)
- [Обратная связь для DOCKER Desktop для Windows: файл проблемы](https://github.com/docker/for-win/issues)
- [Блог VS Code: рекомендации по выбору среды разработки](https://code.visualstudio.com/docs/containers/choosing-dev-environment#_guidelines-for-choosing-a-development-environment)
- [Блог VS Code. Использование DOCKER в WSL 2](https://code.visualstudio.com/blogs/2020/03/02/docker-in-wsl2)
- [Блог VS Code: использование удаленных контейнеров в WSL 2](https://code.visualstudio.com/blogs/2020/07/01/containers-wsl)
- [Hanselminutes подкаст: создание DOCKER замечательная для разработчиков с помощью Simon Феркуел](https://hanselminutes.com/736/making-docker-lovely-for-developers-with-simon-ferquel)